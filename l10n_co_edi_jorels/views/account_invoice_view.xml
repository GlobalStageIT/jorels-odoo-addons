<?xml version="1.0" encoding="utf-8"?>

<!--Jorels S.A.S. - Copyright (2019-2022)-->

<!--This file is part of l10n_co_edi_jorels.-->

<!--l10n_co_edi_jorels is free software: you can redistribute it and/or modify-->
<!--it under the terms of the GNU Lesser General Public License as published by-->
<!--the Free Software Foundation, either version 3 of the License, or-->
<!--(at your option) any later version.-->

<!--l10n_co_edi_jorels is distributed in the hope that it will be useful,-->
<!--but WITHOUT ANY WARRANTY; without even the implied warranty of-->
<!--MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the-->
<!--GNU Lesser General Public License for more details.-->

<!--You should have received a copy of the GNU Lesser General Public License-->
<!--along with l10n_co_edi_jorels.  If not, see <https://www.gnu.org/licenses/>.-->

<!--email: info@jorels.com-->

<odoo>
    <data>
        <record id="account_invoice_view_form_inherit_l10n_co_edi_jorels" model="ir.ui.view">
            <field name="name">account.invoice.view.form.inherit.l10n_co_edi_jorels</field>
            <field name="model">account.invoice</field>
            <field name="inherit_id" ref="account.invoice_form"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='payment_term_id']" position="after">
                    <field name="payment_form_id"/>
                    <field name="payment_method_id"/>
                    <field name="ei_operation"/>
                    <field name="ei_correction_concept_credit_id" attrs="{'invisible':[('type','!=','out_refund')]}"/>
                    <field name="ei_correction_concept_debit_id" attrs="{'invisible':[('type','!=','out_invoice')]}"/>
                    <field name="ei_is_correction_without_reference"
                           attrs="{'invisible':[('type','!=','out_refund')]}"/>
                </xpath>
                <xpath expr="//button[@name='action_invoice_open']" position="after">
                    <button name="validate_dian" type="object" string="Validate DIAN"
                            class="oe_highlight o_invoice_validate" groups="account.group_account_invoice"
                            attrs="{'invisible': ['|',('ei_is_not_test','=',False),('state','!=','validate')]}"/>
                    <button name="skip_validate_dian" type="object" string="Skip DIAN validation"
                            class="oe_highlight o_invoice_validate" groups="account.group_account_invoice"
                            attrs="{'invisible': ['|',('ei_is_not_test','=',True),('state','!=','validate')]}"/>
                    <!-- Buttons visible only in developer mode -->
                    <button name="skip_validate_dian_production" type="object" string="Skip DIAN validation"
                            class="o_invoice_validate" groups="base.group_no_one"
                            attrs="{'invisible': ['|',('ei_is_not_test','=',False),('state','!=','validate')]}"/>
                    <button name="validate_dian_test" type="object" string="Validate DIAN Test"
                            class="o_invoice_validate" groups="base.group_no_one"
                            attrs="{'invisible': ['|',('ei_is_not_test','=',True),('state','!=','validate')]}"/>
                    <button name="status_document" type="object" string="Consult DIAN" groups="base.group_no_one"
                            attrs="{'invisible': [('state','!=','open'),('state','!=','paid')]}"/>
                </xpath>
                <xpath expr="//field[@name='date_due']" position="after">
                    <field name="date_start" groups="l10n_co_edi_jorels.group_invoice_period_enable"/>
                    <field name="date_end" groups="l10n_co_edi_jorels.group_invoice_period_enable"/>
                    <field name="order_ref_number"/>
                    <field name="order_ref_date"/>
                </xpath>
                <xpath expr="//page[@name='other_info']" position="after">
                    <page string="DIAN response" name="info_Dian">
                        <group name="dian_response">
                            <field name="ei_sync"/>
                            <field name="ei_is_not_test"/>
                            <field name="ei_is_valid"/>
                            <field name="ei_is_restored"/>
                            <field name="ei_algorithm"/>
                            <field name="ei_class"/>
                            <field name="ei_number"/>
                            <field name="ei_uuid"/>
                            <field name="ei_issue_date"/>
                            <field name="ei_expedition_date"/>
                            <field name="ei_zip_key"/>
                            <field name="ei_status_code"/>
                            <field name="ei_status_description"/>
                            <field name="ei_status_message"/>
                            <field name="ei_errors_messages"/>
                            <field name="ei_xml_name"/>
                            <field name="ei_zip_name"/>
                            <field name="ei_signature"/>
                            <field name="ei_qr_code"/>
                            <field name="ei_qr_data"/>
                            <field name="ei_qr_link" widget="url"/>
                            <field name="ei_pdf_download_link" widget="url"/>
                            <field name="ei_xml_base64_bytes"/>
                            <field name="ei_application_response_base64_bytes"/>
                            <field name="ei_attached_document_base64_bytes"/>
                            <field name="ei_pdf_base64_bytes"/>
                            <field name="ei_zip_base64_bytes"/>
                            <field name="ei_type_environment"/>
                            <field name="ei_attached_zip_base64_bytes"/>
                            <field name="ei_payload" groups="base.group_no_one"/>
                            <field name="ei_qr_image" widget="image"/>
                            <field name="event"/>
                        </group>
                    </page>
                    <page name="dian_events" string="Dian Events">
                        <field name="radian_ids" context="{'type': 'customer', 'default_invoice_id': id}"
                               options="{'always_reload': True}">
                            <form string="Radian events">
                                <header>
                                    <button string="Validate" name="action_post" type="object" states="draft"
                                            class="oe_highlight"/>
                                    <button name="action_status" type="object" string="Consult DIAN"
                                            groups="base.group_no_one"
                                            attrs="{'invisible': [('state','!=','posted')]}"/>
                                    <button string="Set to Draft" name="action_draft" type="object" states="cancel"/>
                                    <button string="Cancel" name="action_cancel" type="object" states="draft,posted"/>
                                    <field name="state" widget="statusbar" statusbar_visible="draft,posted"/>
                                </header>
                                <sheet>
                                    <h1 class="mt0">
                                        <div attrs="{'invisible': [('name','=',False)]}">
                                            <field name="name" class="oe_inline"/>
                                        </div>
                                    </h1>
                                    <group>
                                        <group name="group-left">
                                            <field name="type" invisible="1"/>
                                            <field name="event_id"/>
                                            <field name="rejection_concept_id"
                                                   attrs="{'invisible':[('event_id','!=',4)]}"/>
                                        </group>
                                        <group name="group-right">
                                            <field name="date"/>
                                            <field name="company_id" groups="base.group_multi_company"/>
                                            <field name="note"/>
                                        </group>
                                    </group>
                                </sheet>
                            </form>
                        </field>
                    </page>
                </xpath>
                <xpath expr="//field[@name='amount_tax']" position="before">
                    <field name="ei_amount_tax_no_withholding"/>
                    <field name="ei_amount_total_no_withholding" class="oe_subtotal_footer_separator"/>
                    <field name="ei_amount_tax_withholding"/>
                </xpath>
                <!-- Invoice lines -->
                <xpath expr="//field[@name='invoice_line_ids']/tree/field[@name='name']" position="after">
                    <field name="ei_notes"/>
                </xpath>
                <xpath expr="//field[@name='journal_id']" position="after">
                    <field name="is_out_country"/>
                </xpath>
            </field>
        </record>

        <record id="account_invoice_supplier_view_form_inherit_l10n_co_edi_jorels" model="ir.ui.view">
            <field name="name">account.invoice.supplier.view.form.inherit.l10n_co_edi_jorels</field>
            <field name="model">account.invoice</field>
            <field name="inherit_id" ref="account.invoice_supplier_form"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='vendor_bill_id']" position="after">
                    <field name="ei_operation"/>
                    <field name="ei_correction_concept_credit_id" attrs="{'invisible':[('type','!=','in_refund')]}"/>
                    <field name="ei_correction_concept_debit_id" attrs="{'invisible':[('type','!=','in_invoice')]}"/>
                    <field name="ei_is_correction_without_reference"
                           attrs="{'invisible':[('type','!=','in_refund')]}"/>
                </xpath>
                <xpath expr="//field[@name='date_due']" position="after">
                    <field name="date_start" groups="l10n_co_edi_jorels.group_invoice_period_enable"/>
                    <field name="date_end" groups="l10n_co_edi_jorels.group_invoice_period_enable"/>
                    <field name="order_ref_number"/>
                    <field name="order_ref_date"/>
                </xpath>
                <xpath expr="//page[@name='other_info']" position="after">
                    <page string="DIAN response" name="info_Dian">
                        <group name="dian_response">
                            <!--                            <field name="ei_sync"/>-->
                            <field name="ei_is_not_test" invisible="1"/>
                            <field name="ei_is_valid"/>
                            <!--                            <field name="ei_is_restored"/>-->
                            <!--                            <field name="ei_algorithm"/>-->
                            <!--                            <field name="ei_class"/>-->
                            <field name="ei_number"/>
                            <field name="ei_uuid"/>
                            <field name="ei_issue_date"/>
                            <!--                            <field name="ei_expedition_date"/>-->
                            <field name="ei_zip_key" attrs="{'invisible':[('ei_is_not_test','=',True)]}"/>
                            <!--                            <field name="ei_status_code"/>-->
                            <!--                            <field name="ei_status_description"/>-->
                            <!--                            <field name="ei_status_message"/>-->
                            <!--                            <field name="ei_errors_messages"/>-->
                            <!--                            <field name="ei_xml_name"/>-->
                            <!--                            <field name="ei_zip_name"/>-->
                            <!--                            <field name="ei_signature"/>-->
                            <!--                            <field name="ei_qr_code"/>-->
                            <!--                            <field name="ei_qr_data"/>-->
                            <!--                            <field name="ei_qr_link" widget="url"/>-->
                            <!--                            <field name="ei_pdf_download_link" widget="url"/>-->
                            <!--                            <field name="ei_xml_base64_bytes"/>-->
                            <!--                            <field name="ei_application_response_base64_bytes"/>-->
                            <field name="ei_attached_document_base64_bytes"/>
                            <field name="ei_pdf_base64_bytes"/>
                            <!--                            <field name="ei_zip_base64_bytes"/>-->
                            <field name="ei_type_environment"/>
                            <field name="ei_attached_zip_base64_bytes"/>
                            <!--                            <field name="ei_payload" groups="base.group_no_one"/>-->
                            <!--                            <field name="ei_qr_image" widget="image"/>-->
                            <!--                            <field name="event"/>-->
                        </group>
                    </page>
                    <page name="dian_events" string="Dian Events">
                        <field name="radian_ids" context="{'type': 'supplier', 'default_invoice_id': id}"
                               options="{'always_reload': True}">
                            <form string="Radian events">
                                <header>
                                    <button string="Validate" name="action_post" type="object" states="draft"
                                            class="oe_highlight"/>
                                    <button name="action_status" type="object" string="Consult DIAN"
                                            groups="base.group_no_one"
                                            attrs="{'invisible': [('state','!=','posted')]}"/>
                                    <button string="Set to Draft" name="action_draft" type="object" states="cancel"/>
                                    <button string="Cancel" name="action_cancel" type="object" states="draft,posted"/>
                                    <field name="state" widget="statusbar" statusbar_visible="draft,posted"/>
                                </header>
                                <sheet>
                                    <h1 class="mt0">
                                        <div attrs="{'invisible': [('name','=',False)]}">
                                            <field name="name" class="oe_inline"/>
                                        </div>
                                    </h1>
                                    <group>
                                        <group name="group-left">
                                            <field name="type" invisible="1"/>
                                            <field name="event_id"/>
                                            <field name="rejection_concept_id"
                                                   attrs="{'invisible':[('event_id','!=',4)]}"/>
                                        </group>
                                        <group name="group-right">
                                            <field name="date"/>
                                            <field name="company_id" groups="base.group_multi_company"/>
                                            <field name="note"/>
                                        </group>
                                    </group>
                                </sheet>
                            </form>
                        </field>
                    </page>
                </xpath>
                <xpath expr="//field[@name='amount_tax']" position="before">
                    <field name="ei_amount_tax_no_withholding"/>
                    <field name="ei_amount_total_no_withholding" class="oe_subtotal_footer_separator"/>
                    <field name="ei_amount_tax_withholding"/>
                </xpath>
                <!-- Invoice lines -->
                <xpath expr="//field[@name='invoice_line_ids']/tree/field[@name='name']" position="after">
                    <field name="ei_notes"/>
                </xpath>
                <xpath expr="//field[@name='journal_id']" position="after">
                    <field name="is_out_country"/>
                </xpath>
            </field>
        </record>

        <record id="action_is_attached_document_matched" model="ir.actions.server">
            <field name="name">Review attached document</field>
            <field name="model_id" ref="account.model_account_invoice"/>
            <field name="binding_model_id" ref="account.model_account_invoice"/>
            <field name="state">code</field>
            <field name="code">records._is_attached_document_matched()</field>
        </record>

        <record id="action_status_document_log" model="ir.actions.server">
            <field name="name">Replace with log DIAN</field>
            <field name="model_id" ref="account.model_account_invoice"/>
            <field name="binding_model_id" ref="account.model_account_invoice"/>
            <field name="state">code</field>
            <field name="code">records.status_document_log()</field>
        </record>
    </data>
</odoo>